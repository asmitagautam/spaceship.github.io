<!DOCTYPE html>
<!--
Final Project: SpaceWars2050
Mai Ngo, Asmita Gautam, Miriam Hodas, Stacy Falaleeva

Note: Borrowed some code from the PaddleBall sprint (moving left and right)
-->
<html>
<head>
<title>SpaceWars2050</title>
<link href="/css/style.css" rel="stylesheet">
<img id="spaceship" width="0" height="0" src="spaceship.png" alt="SpaceShip">
<link href="https://fonts.googleapis.com/css?family=Dosis" rel="stylesheet">
<img id="asteroid" width="0" height="0" src="asteroid.png" alt="Asteroid">
<img id="alien" width="0" height="0" src="alien.png" alt="Alien">
<script>
    let canvas;    // DOM object corresponding to the canvas
    let graphics;  // 2D graphics context for drawing on the canvas
    let spaceship_x = 550;
    let spaceship_y = 550;
    let shots = [];
    let lives = 3;

    let rightPressed = false;
    let leftPressed = false;
    let sPressed = false;
    let score = 0;
    let checkTime = 0;

    // Asteroid will have a radius of 10px
	  let asteroidRadius = 40;

	  // Asteroid start off point
	  let asteroidX = 600;
	  let asteroidY = 0;

	  // Alien will have a radius of 10px
	  let alienRadius = 40;

    // Alien start off point
    let alienX = 300;
    let alienY = 0;

    // And when the asteroid moves, we'll shift 2px at a time
    let ast_dx = 5;
    let ast_dy = 5;

    // And when the alien moves, we'll shift 2px at a time
    let alien_dx = 5;
    let alien_dy = 5;

    // Add event listeners for keydown and keyup events.
    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);

    // Create Handlers for keydown and keyup events
    function keyDownHandler(e) {
      // e.keyCode == 39 (right arrow key)
      // e.keyCode == 37 (left arrow key)
      if (e.keyCode == 39) {
        rightPressed = true;
      } else if (e.keyCode == 37) {
        leftPressed = true;
      } else if (e.keyCode == 83) {
      let currentTime = new Date();
      if((currentTime.getTime() - checkTime) > 100){
        sPressed = true;
        checkTime =currentTime.getTime();
    }
      }
    }

    function keyUpHandler(e) {
      if (e.keyCode == 39) {
        rightPressed = false;
      } else if (e.keyCode == 37) {
        leftPressed = false;
      } else if (e.keyCode == 83) {
      sPressed = false;
      }
    }

    function drawSpaceship(x, y){
      graphics.drawImage(spaceship, x, y, 40, 40);
      //graphics.fillStyle = "Red";
      //graphics.fillRect(225, 480, 15, 15);
      //graphics.fillRect(x, y, 15, 15);
    }

     function drawShooting(x, y){
      graphics.fillRect(x, y, 10, 10);
      graphics.fillStyle = "Red";
      //graphics.fillRect(225, 480, 15, 15);
      //graphics.fillRect(x, y, 15, 15);
    }

    /* -------------------------------------------------
    Draw the lives in the upper left hand corner
    -------------------------------------------------- */
    function drawLives(){
      for (i=0; i<lives; i++){
        graphics.drawImage(spaceship, 5+(i*35), 35, 25,25);
      }
    }

    /* -------------------------------------------------
    Draw a circle on the canvas to represent the asteroid
    ------------------------------------------------- */
    function drawAsteroid() {
    	//graphics.beginPath();
    	//graphics.arc(asteroidX, asteroidY, asteroidRadius, 0, Math.PI*2);
    	//graphics.fill();
    	//graphics.closePath();
      graphics.drawImage(asteroid, asteroidX, asteroidY, 40, 40);
    }
    /* -------------------------------------------------
    Draw a circle on the canvas to represent the asteroid
    ------------------------------------------------- */
    function drawAlien() {
    	//graphics.beginPath();
    	//graphics.arc(alienX, alienY, alienRadius, 0, Math.PI*2);
    	//graphics.fill();
    	//graphics.closePath();
      graphics.drawImage(alien, alienX, alienY, 40, 40);
    }

    function drawScore() {
    WebFontConfig = {
      google: {
        families: ['Dosis Semi-Bold']
      }
    };
    graphics.font = "25px Dosis"
    graphics.fillText("Score: "+score, 8, 25);
    }

    function getRandomInt(min, max) {
    	return Math.random() * (max - min) + min;
    }

    function draw(){
      // clear the canvas
      graphics.clearRect(0, 0, canvas.width, canvas.height);
      // If spaceship should be moving right, and is not at the right wall
      if (rightPressed && spaceship_x <canvas.width-15){
        spaceship_x += 5;
      }
      // If spaceship shoul be moving left and is not at the left wall
      else if (leftPressed && spaceship_x > 0){
        spaceship_x -= 5;
      }
      if (sPressed){
      if (shots.length < 20){
      let new_shoot = [spaceship_x+20, spaceship_y];
      shots.push(new_shoot);
      }
      }

      drawSpaceship(spaceship_x, spaceship_y);
      drawLives();

      for (i = 0; i < shots.length; i++) {
       drawShooting(shots[i][0], shots[i][1]);
       shots[i][1] -= 5;

        if(shots[i][1] + 5 < 10) {
        shots.splice(i, 1);
    }
    }
    	// Draw various game components
    	drawAsteroid();
    	drawAlien();
    	drawScore();

    	collisionDetection();

    	// If the asteroid hits the LEFT/RIGHT WALL,
    	// switch horizontal travel direction
    	if(asteroidX > canvas.width + asteroidRadius){
        	asteroidX = canvas.width;
        	asteroidY = 0;
        	ast_dx = -2
    	}
    	if(asteroidX < -asteroidRadius){
    		asteroidX = 0;
        asteroidY = 0;
        ast_dx = 2;
    	}

    	// If the asteroid hits the LOWER WALL
    	// switch vertical travel direction
    	if(asteroidY > canvas.height + asteroidRadius) {
        asteroidY = 0;
    	}

    	// Move the asteroid
    	asteroidX += ast_dx;
    	asteroidY += ast_dy;


     	alienX += alien_dx;
     	alienY += alien_dy;
     	if (alienX >= 0 && alienX < canvas.width/3){
     		if (alienX + alienRadius > canvas.width/3 || alienX < 0){
    			alien_dx = alien_dx * -1;
    		}
    	}

    	if (alienX >= canvas.width/3  && alienX < 2*(canvas.width/3)){
     		if (alienX + alienRadius > (canvas.width/3)*2 || alienX < canvas.width/3){
    			alien_dx = alien_dx * -1;
    		}
    	}
      if (alienX >= (canvas.width/3)*2  && alienX < canvas.width){
  			if (alienX + alienRadius > canvas.width || alienX < (canvas.width/3)*2){
    			alien_dx = alien_dx * -1;
    		}
    	}

   		if(alienY > canvas.height + alienRadius) {
        	alienY = 0;
        	alienX = getRandomInt(0, canvas.width);
    	}

      // Tell JS to animate frame by recursively calling
      requestAnimationFrame(draw);
    }

    function collisionDetection() {
     if (((asteroidX >= spaceship_x) && (asteroidX <= spaceship_x + 10)
      && (asteroidY >= spaceship_y) && (asteroidY <= spaceship_y + 10)) ||
     ((alienX >= spaceship_x) && (alienX <= spaceship_x + 10)
      && (alienY >= spaceship_y) && (alienY <= spaceship_y + 10))){
			alert ("You lose!");
			document.location.reload();
		}

		for (i = 0; i < shots.length; i++) {
		  if (((asteroidX >= shots[i][0]) && (asteroidX <= shots[i][0] + 10)
      && (asteroidY >= shots[i][1]) && (asteroidY <= shots[i][1] + 10)) ||
     ((alienX >= shots[i][0]) && (alienX <= shots[i][0] + 10)
      && (alienY >= shots[i][1]) && (alienY <= shots[i][1] + 10))){
      	asteroidX = getRandomInt(0, canvas.width);
      	asteroidY = 0;
      	alienX = getRandomInt(0, canvas.width);
      	alienY = 0;
      	score += 1;
      }
    }
  }

    function init() {
        canvas = document.getElementById("theCanvas");
        graphics = canvas.getContext("2d");
        let spaceship = document.getElementById("spaceship");
        let asteroid = document.getElementById("asteroid");
        let alien = document.getElementById("alien");
        draw();  // draw something on the canvas
    }


</script>
</head>
<body onload="init()">
  <div class="outer">
    <div class="inner"></div>
    <canvas id="theCanvas" width="600" height="1200"></canvas>
  </div>

</body>
</html>
