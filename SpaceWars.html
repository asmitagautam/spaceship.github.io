<!DOCTYPE html>
<!--
Final Project: SpaceWars2050
Mai Ngo, Asmita Gautam, Miriam Hodas, Stacey Falaleeva

Note: Borrowed some code from the PaddleBall sprint (moving left and right)
-->
<html>
<head>
<title>SpaceWars2050</title>
<link href="spaceWars.css" ref="stylesheet">
<img id="spaceship" width="20" height="20" src="spaceship.png" alt="SpaceShip">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    let canvas;    // DOM object corresponding to the canvas
    let graphics;  // 2D graphics context for drawing on the canvas
    let spaceship_x = 450;
    let spaceship_y = 450;
    let shots = [];
    let rightPressed = false;
    let leftPressed = false;
    let sPressed = false;
    let score = 0;
    
    // Asteroid will have a radius of 10px
	  let asteroidRadius = 10;

	  // Asteroid start off point
	  let asteroidX = 900;
	  let asteroidY = 0;

	  // Alien will have a radius of 10px
	  let alienRadius = 10;

    // Alien start off point
    let alienX = 450;
    let alienY = 0;

    // And when the asteroid moves, we'll shift 2px at a time
    let ast_dx = 2;
    let ast_dy = 2;

    // And when the alien moves, we'll shift 2px at a time
    let alien_dx = 2;
    let alien_dy = 2;

    // Add event listeners for keydown and keyup events.
    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);

    // Create Handlers for keydown and keyup events
    function keyDownHandler(e) {
      // e.keyCode == 39 (right arrow key)
      // e.keyCode == 37 (left arrow key)
      if (e.keyCode == 39) {
        rightPressed = true;
      } else if (e.keyCode == 37) {
        leftPressed = true;
      } else if (e.keyCode == 83) {
        sPressed = true;
    }
    }

    function keyUpHandler(e) {
      if (e.keyCode == 39) {
        rightPressed = false;
      } else if (e.keyCode == 37) {
        leftPressed = false;
      } else if (e.keyCode == 83) {
      sPressed = false;
    }
    }

    function drawSpaceship(x, y){
      graphics.drawImage(spaceship, x, y, 40, 40);
      graphics.fillStyle = "Red";
      //graphics.fillRect(225, 480, 15, 15);
      //graphics.fillRect(x, y, 15, 15);
    }
    
     function drawShooting(x, y){
      graphics.fillRect(x, y, 10, 10);
      graphics.fillStyle = "Red";
      //graphics.fillRect(225, 480, 15, 15);
      //graphics.fillRect(x, y, 15, 15);
    }
    /* -------------------------------------------------
    Draw a circle on the canvas to represent the asteroid
    ------------------------------------------------- */
    function drawAsteroid() {
    	graphics.beginPath();
    	graphics.arc(asteroidX, asteroidY, asteroidRadius, 0, Math.PI*2);
    	graphics.fill();
    	graphics.closePath();
    }
    /* -------------------------------------------------
    Draw a circle on the canvas to represent the asteroid
    ------------------------------------------------- */
    function drawAlien() {
    	graphics.beginPath();
    	graphics.arc(alienX, alienY, alienRadius, 0, Math.PI*2);
    	graphics.fill();
    	graphics.closePath();
    }
    
    function drawScore() {
    graphics.fillText("Score: "+score, 8, 20);
}

    function getRandomInt(min, max) {
    	return Math.random() * (max - min) + min;
    }

    function draw(){
      // clear the canvas
      graphics.clearRect(0, 0, canvas.width, canvas.height);
      // If spaceship should be moving right, and is not at the right wall
      if (rightPressed && spaceship_x <canvas.width-15){
        spaceship_x += 5;
      }
      // If spaceship shoul be moving left and is not at the left wall
      else if (leftPressed && spaceship_x > 0){
        spaceship_x -= 5;
      }
      if (sPressed){
      let new_shoot = [spaceship_x+20, spaceship_y];
      shots.push(new_shoot);
      }
      
      drawSpaceship(spaceship_x, spaceship_y);
      
      for (i = 0; i < shots.length; i++) { 
       drawShooting(shots[i][0], shots[i][1]);
       shots[i][1] -= 5;
       }
       
       
    	// Draw various game components
    	drawAsteroid();
    	drawAlien();
    	drawScore();
    	
    	collisionDetection();

    	// If the asteroid hits the LEFT/RIGHT WALL,
    	// switch horizontal travel direction
    	if(asteroidX > canvas.width + asteroidRadius){
        	asteroidX = canvas.width;
        	asteroidY = 0;
        	ast_dx = -2
    	}
    	if(asteroidX < -asteroidRadius){
    		asteroidX = 0;
        	asteroidY = 0;
        	ast_dx = 2;
    	}

    	// If the asteroid hits the LOWER WALL
    	// switch vertical travel direction
    	if(asteroidY > canvas.height + asteroidRadius) {
        	asteroidY = 0;
    	}

    	// Move the asteroid
    	asteroidX += ast_dx;
    	asteroidY += ast_dy;


     	alienX += alien_dx;
     	alienY += alien_dy;
     	if (alienX >= 0 && alienX < canvas.width/3){
     		if (alienX + alienRadius > canvas.width/3 || alienX < 0){
    			alien_dx = alien_dx * -1;
    		}
    	}

    	if (alienX >= canvas.width/3  && alienX < 2*(canvas.width/3)){
     		if (alienX + alienRadius > (canvas.width/3)*2 || alienX < canvas.width/3){
    			alien_dx = alien_dx * -1;
    		}
    	}
      if (alienX >= (canvas.width/3)*2  && alienX < canvas.width){
  			if (alienX + alienRadius > canvas.width || alienX < (canvas.width/3)*2){
    			alien_dx = alien_dx * -1;
    		}
    	}

   		if(alienY > canvas.height + alienRadius) {
        	alienY = 0;
        	alienX = getRandomInt(0, canvas.width);
    	}

      // Tell JS to animate frame by recursively calling
      requestAnimationFrame(draw);
    }
    
    function collisionDetection() {
     if (((asteroidX >= spaceship_x) && (asteroidX <= spaceship_y + 10) 
      && (asteroidY >= spaceship_y) && (asteroidY <= spaceship_y + 10)) ||
     ((alienX >= spaceship_x) && (alienX <= spaceship_y + 10) 
      && (alienY >= spaceship_y) && (alienY <= spaceship_y + 10))){
			alert ("You lose!");
			document.location.reload();
		}
		
		for (i = 0; i < shots.length; i++) { 
		  if (((asteroidX >= shots[i][0]) && (asteroidX <= shots[i][0] + 10) 
      && (asteroidY >= shots[i][1]) && (asteroidY <= shots[i][1] + 10)) ||
     ((alienX >= shots[i][0]) && (alienX <= shots[i][0] + 10) 
      && (alienY >= shots[i][1]) && (alienY <= shots[i][1] + 10))){
      	asteroidX = getRandomInt(0, canvas.width);
      	asteroidY = 0;
      	alienX = getRandomInt(0, canvas.width);
      	alienY = 0;
      	score += 1;
       }
       }
       }

    function init() {
        canvas = document.getElementById("theCanvas");
        graphics = canvas.getContext("2d");
        let spaceship = document.getElementById("spaceship");
        draw();  // draw something on the canvas
    }


</script>
</head>
<body onload="init()">
    <canvas id="theCanvas" width="900" height="500"></canvas>
</body>
</html>
